<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
	<div th:replace="~{fragment :: meta}"></div>
	<div th:replace="~{fragment :: styles}"></div>

	<title>レビュー投稿</title>
</head>

<body>
	<div class="samuraitravel-wrapper">
		<!-- ヘッダー -->
		<div th:replace="~{fragment :: header}"></div>

		<main>
			<div class="container pt-4 pb-5 samuraitravel-container">
				<div class="row justify-content-center">
					<div class="col-xxl-8 col-xl-9 col-lg-10">

						<!-- パンくず -->
						<nav class="mb-4" style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
							<ol class="breadcrumb mb-0 justify-content-center">
								<li class="breadcrumb-item"><a th:href="@{/}">ホーム</a></li>
								<li class="breadcrumb-item"><a th:href="@{/houses}">民宿一覧</a></li>
								<li class="breadcrumb-item">
									<a th:href="@{/houses/{id}(id=${house.id})}">民宿詳細</a>
								</li>
								<li class="breadcrumb-item active" aria-current="page">レビュー投稿</li>
							</ol>
						</nav>

						<!-- タイトル -->
						<h1 class="mb-4 text-center">
							<span th:text="${house.name}">ペンション SAMURAI</span>のレビュー投稿
						</h1>

						<!-- エラーメッセージ -->
						<div th:if="${errorMessage}" class="alert alert-danger">
							<span th:text="${errorMessage}"></span>
						</div>

						<!-- レビュー投稿フォーム -->
						<div class="row justify-content-center">
							<div class="col-md-8">

								<form method="post" th:action="@{/houses/{id}/reviews(id=${house.id})}"
									th:object="${reviewForm}">

									<!-- CSRFトークン -->
									<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

									<!-- 評価 -->
									<div class="mb-4">
										<label class="form-label fw-bold">評価</label>

										<!-- ドロップダウン -->
										<select class="form-select text-warning" th:field="*{rating}" id="ratingSelect">
											<option value="">選択してください</option>
											<option value="5">★★★★★</option>
											<option value="4">★★★★☆</option>
											<option value="3">★★★☆☆</option>
											<option value="2">★★☆☆☆</option>
											<option value="1">★☆☆☆☆</option>
										</select>

										<!-- バリデーションエラー -->
										<div th:if="${#fields.hasErrors('rating')}" class="text-danger small mt-1"
											th:errors="*{rating}"></div>
									</div>

									<!-- コメント -->
									<div class="mb-4">
										<label class="form-label fw-bold">コメント</label>
										<textarea class="form-control" rows="5" th:field="*{comment}"
											placeholder="宿泊した感想を入力してください"></textarea>
										<div th:if="${#fields.hasErrors('comment')}" class="text-danger small mt-1"
											th:errors="*{comment}"></div>
									</div>

									<!-- 投稿ボタン -->
									<div class="text-center">
										<button type="submit" class="btn text-white shadow-sm w-50 samuraitravel-btn">
											投稿
										</button>
									</div>

								</form>
							</div>
						</div>

					</div>
				</div>
			</div>
		</main>

		<!-- フッター -->
		<div th:replace="~{fragment :: footer}"></div>
	</div>

	<div th:replace="~{fragment :: scripts}"></div>

	<!-- ★ 評価表示用JavaScript -->
	<script>
		const ratingSelect = document.getElementById("ratingSelect");

		function updateSelectColor() {
			if (ratingSelect.value === "") {
				// 未選択のときだけ黒
				ratingSelect.classList.remove("text-warning");
			} else {
				// 選択されたら黄色
				ratingSelect.classList.add("text-warning");
			}
		}

		// 初期表示（画面表示時）
		updateSelectColor();

		// 選択が変わったとき
		ratingSelect.addEventListener("change", updateSelectColor);
	</script>

</body>

</html>